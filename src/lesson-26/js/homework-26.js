
//* ‚ú¥Ô∏è –¶—ñ–ª—å: –°—Ç–≤–æ—Ä–∏—Ç–∏ –í–µ–±-–¥–æ–¥–∞—Ç–æ–∫ –Ω–∞ –±–∞–∑—ñ –±–∞–Ω–¥–ª–µ—Ä–∞ Vite,
//* —è–∫–∏–π –ø–æ–≤–∏–Ω–µ–Ω –¥–æ–∑–≤–æ–ª—è—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –¥–æ–¥–∞–≤–∞—Ç–∏, –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏,
//* –≤–∏–¥–∞–ª—è—Ç–∏ —Ç–∞ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –¥–∞–Ω—ñ –ø—Ä–æ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤,
//* –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö JSON.

//? 1.–ö–æ–∂–µ–Ω –∑–∞–ø–∏—Å –ø—Ä–æ —Å—Ç—É–¥–µ–Ω—Ç–∞ –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é:
//?  üî∏ —ñ–º'—è,
//?  üî∏ –ø—Ä—ñ–∑–≤–∏—â–µ,
//?  üî∏ –≤—ñ–∫,
//?  üî∏ –∫—É—Ä—Å,
//?  üî∏ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç.

//? 2.–ö–æ–∂–Ω–∞ –Ω–æ–≤–∞ –∫–∞—Ä—Ç–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞ –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ –º–∞—Å–∏–≤—É –¥–∞–Ω–∏—Ö dataArray,
//? —è–∫ –æ–∫—Ä–µ–º–∏–π –æ–±‚Äô—î–∫—Ç, –≤ –∫—ñ–Ω–µ—Ü—å —Ü—å–æ–≥–æ –º–∞—Å–∏–≤—É –æ–±‚Äô—î–∫—Ç—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ñ–æ—Ä–º–∏,
//? —è–∫–∞ –∑‚Äô—è–≤–ª—è—î—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ –∫–Ω–æ–ø–∫—É ¬´–î–æ–¥–∞—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞¬ª
//? —Ç–∞ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –ø–µ—Ä–µ–¥ –°–ø–∏—Å–∫–æ–º —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤.

//? 3.–ù–∞ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –∫—Ä–æ—Ü—ñ, –º–∞—Å–∏–≤ –æ–±‚Äô—î–∫—Ç—ñ–≤ dataArray —Ç—Ä–µ–±–∞ –∫–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏
//? —É JSON - —Ñ–æ—Ä–º–∞—Ç —Ç–∞ –∑–∞–ø–∏—Å–∞—Ç–∏ —É –∑–º—ñ–Ω–Ω—É dataJSON.

//? 4.–ù–∞  —Ü—å–æ–º—É –µ—Ç–∞–ø—ñ –ø–µ—Ä–µ–¥–±–∞—á–∞—î—Ç—å—Å—è –ø–µ—Ä–µ–¥–∞—á–∞ —Ñ–∞–π–ª—É dataJSON –∑ Frontend
//? –Ω–∞ Backend, –∞ –ø–æ—Ç—ñ–º —É –∑–≤–æ—Ä–æ—Ç–Ω–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É.–¶–µ–π –∫—Ä–æ–∫ –±—É–¥–µ —Ä–µ—Ç–µ–ª—å–Ω–æ
//? —Ä–æ–∑–≥–ª—è–Ω—É—Ç–∏–π —É –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö —Å–µ–º–µ—Å—Ç—Ä–∞—Ö –≤ —Ä–∞–º–∫–∞—Ö –∫—É—Ä—Å—É ¬´Backend¬ª.

//? 5.–ü—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∫–æ–∂–Ω–æ—ó –Ω–æ–≤–æ—ó –∫–∞—Ä—Ç–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞  –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–Ω–æ–≤–∏—Ç–∏
//? –º–∞—Å–∏–≤ –æ–±‚Äô—î–∫—Ç—ñ–≤ dataArray, –∞ —Ç–∞–∫–æ–∂ –∑–Ω–æ–≤—É –æ–Ω–æ–≤–∏—Ç–∏ –≤–µ—Å—å —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
//? —É –∑–º—ñ–Ω–Ω—ñ–π dataJSON, —Ç–∞ ¬´–ø–µ—Ä–µ–º–∞–ª—é–≤–∞—Ç–∏¬ª –π–æ–≥–æ –≤—ñ–¥–Ω–æ—Å–Ω–æ –µ–ª–µ–º–µ–Ω—Ç—É
//? <ul id="students-list"></ul>. –î–ª—è –ø–æ–±—É–¥–æ–≤–∏ —Å–ø–∏—Å–∫—É —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
//? –¥–∞–Ω—ñ —Ç—Ä–µ–±–∞ –±—Ä–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∑ JSON-—Ñ–∞–π–ª—É dataJSON.

//? 6.–ö–æ–∂–µ–Ω –∑–∞–ø–∏—Å –ø—Ä–æ —Å—Ç—É–¥–µ–Ω—Ç–∞ ‚Äì —Ü–µ –æ–∫—Ä–µ–º–∞ –∫–∞—Ä—Ç–∫–∞ –≤ —Å–ø–∏—Å–∫—É –≤—Å—ñ—Ö —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤,
//? —è–∫–∞ –º–∞—î –≤—Å—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ, –∑–∞–∑–Ω–∞—á–µ–Ω—ñ —É –ø—É–Ω–∫—Ç—ñ 1, —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è,
//? –∞ —Ç–∞–∫–æ–∂ –º–∞—î –¥–≤—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –∫–Ω–æ–ø–∫–∏ ¬´Edit¬ª —Ç–∞ ¬´Delete¬ª –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
//? —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ü—ñ—î—ó –∫–∞—Ä—Ç–∫–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö —Ñ–æ—Ä–º, —è–∫—ñ –∑‚Äô—è–≤–ª—è—Ç—å—Å—è
//? –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ –Ω–∏—Ö. –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ –∫–Ω–æ–ø–∫—É ¬´Delete¬ª –ø–æ—Ç—Ä—ñ–±–Ω–æ
//? –≤–∏–≤–µ—Å—Ç–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —É –≤–∏–≥–ª—è–¥—ñ —Ñ–æ—Ä–º–∏ —Å –∑–∞–ø–∏—Ç–∞–Ω–Ω—è–º ¬´–í–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ä—Ç–∫—É?¬ª
//? —Ç–∞ –∫–Ω–æ–ø–∫–∞–º–∏ ¬´–¢–∞–∫¬ª —ñ ¬´–ù—ñ¬ª. –ü—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∑–∞–ø–∏—Å—É, –¥–∞–Ω—ñ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏
//? –≤–∏–¥–∞–ª–µ–Ω—ñ –∑ –º–∞—Å–∏–≤—É –æ–±‚Äô—î–∫—Ç—ñ–≤ dataArray —Ç–∞ –∑ JSON-—Ñ–∞–π–ª—É dataJSON.
//? –ü—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –∑–∞–ø–∏—Å—É (¬´Edit¬ª), –¥–∞–Ω—ñ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ —Ç–∞–∫–æ–∂ –∑–º—ñ–Ω–µ–Ω—ñ –≤ –º–∞—Å–∏–≤—ñ
//? –æ–±‚Äô—î–∫—Ç—ñ–≤ dataArray —Ç–∞ —É JSON-—Ñ–∞–π–ª—É dataJSON.

//? 7.–î–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É Handlebars
//? –∑ –æ–∫—Ä–µ–º–∏–º —à–∞–±–ª–æ–Ω–æ–º template-student-data.hbs.

//? 8.–î–ª—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —É —Ñ–æ—Ä–º–∞—Ç JSON —Ç–∞ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑ —Ñ–æ—Ä–º–∞—Ç—É JSON
//? —É –∑–≤–∏—á–∞–π–Ω–∏–π –æ–±'—î–∫—Ç, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –º–µ—Ç–æ–¥–∏ JSON.stringify() —Ç–∞ JSON.parse() –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ.

//? 9.–ü—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ, –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∑–∞–ø–∏—Å—ñ–≤, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–∏–π
//? —É —Ä–∞–∑—ñ –≤–≤–µ–¥–µ–Ω–Ω—è –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏—Ö –¥–∞–Ω–∏—Ö, —è–∫—ñ –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å —Ñ–æ—Ä–º–∞—Ç—É JSON –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é
//? –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó try...catch.

 
//? ‚ú≥Ô∏è –î–æ–¥–∞—Ç–∫–æ–≤—ñ —É—Ç–æ—á–Ω–µ–Ω–Ω—è: –Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ
//? ‚Ä¢ –î–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º–∏–π —Ñ–∞–π–ª students.json.
//? ‚Ä¢ –î–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–∞–±–ª–∏—Ü—é.
//? ‚Ä¢ –î–æ–¥–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Å–∏ –ø—Ä–æ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –∑ —Ñ–æ—Ä–º–æ—é –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è.
//? ‚Ä¢ –î–æ–¥–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –ø–æ—à—É–∫—É —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –∑–∞ –ø—Ä—ñ–∑–≤–∏—â–µ–º –∞–±–æ –∫—É—Ä—Å–æ–º. 
import Handlebars from "handlebars";
import studentTemplate from "../handlebars/lesson26.hbs?raw";

let dataArray = [];
let dataJSON = "";


const btnAddStudent = document.getElementById("btn-add-student");
const btnCancel = document.getElementById("btn-cancel");
const formArea = document.getElementById("form-area");
const studentForm = document.getElementById("student-form");
const studentsList = document.getElementById("students-list");

let editId = null;


btnAddStudent.addEventListener("click", () => {
  formArea.classList.remove("hidden");
  studentForm.reset();
  editId = null;
  document.getElementById("form-title").textContent = "–ù–æ–≤–∞ –∫–∞—Ä—Ç–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞";
});


btnCancel.addEventListener("click", () => {
  formArea.classList.add("hidden");
  studentForm.reset();
});


studentForm.addEventListener("submit", (e) => {
  e.preventDefault();
  const formData = new FormData(studentForm);
  const student = Object.fromEntries(formData.entries());

  student.age = Number(student.age);
  student.course = Number(student.course);

  try {
    if (editId) {
      const idx = dataArray.findIndex((s) => s.id === editId);
      dataArray[idx] = { ...dataArray[idx], ...student };
      editId = null;
    } else {
      student.id = Date.now();
      dataArray.push(student);
    }

    dataJSON = JSON.stringify(dataArray, null, 2);
    renderStudents();

    formArea.classList.add("hidden");
    studentForm.reset();
  } catch (err) {
    alert("–ü–æ–º–∏–ª–∫–∞ JSON: " + err.message);
  }
});

function renderStudents() {
  studentsList.innerHTML = "";
  try {
    const parsed = JSON.parse(dataJSON);
    const template = Handlebars.compile(studentTemplate);

    parsed.forEach((student) => {
      studentsList.insertAdjacentHTML("beforeend", template(student));
    });
  } catch (err) {
    console.error("JSON parse error:", err);
  }
}


studentsList.addEventListener("click", (e) => {
  const li = e.target.closest(".student-card");
  if (!li) return;
  const id = Number(li.dataset.id);

  if (e.target.classList.contains("delete-btn")) {
    if (confirm("–í–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ä—Ç–∫—É?")) {
      dataArray = dataArray.filter((s) => s.id !== id);
      dataJSON = JSON.stringify(dataArray, null, 2);
      renderStudents();
    }
  }

  if (e.target.classList.contains("edit-btn")) {
    const student = dataArray.find((s) => s.id === id);
    if (student) {
      formArea.classList.remove("hidden");
      document.getElementById("form-title").textContent = "–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç–∞";
      studentForm.firstName.value = student.firstName;
      studentForm.lastName.value = student.lastName;
      studentForm.age.value = student.age;
      studentForm.course.value = student.course;
      studentForm.faculty.value = student.faculty;
      editId = id;
    }
  }
});
